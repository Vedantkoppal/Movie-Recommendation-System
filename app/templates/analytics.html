{% extends "base.html" %}
{% block content %}

<div class="container mx-auto p-6 bg-gray-900 text-white rounded-lg shadow-lg">
    <h2 class="text-3xl font-bold text-center text-red-500 mb-6">Live Site Analytics</h2>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 text-center">
        <div class="p-4 bg-gray-800 rounded-lg shadow">
            <p class="text-xl font-semibold">Total Visitors</p>
            <p class="text-2xl text-red-400 font-bold" id="total">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg shadow">
            <p class="text-xl font-semibold">Total Unique Visitors</p>
            <p class="text-2xl text-blue-400 font-bold" id="unique">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg shadow">
            <p class="text-xl font-semibold">Today's Visitors</p>
            <p class="text-2xl text-yellow-400 font-bold" id="daily">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg shadow">
            <p class="text-xl font-semibold">Today's Unique Visitors</p>
            <p class="text-2xl text-green-400 font-bold" id="daily_unique">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg shadow md:col-span-2 lg:col-span-1">
            <p class="text-xl font-semibold">Current Active Visitors</p>
            <p class="text-2xl text-purple-400 font-bold" id="active">0</p>
        </div>
    </div>

    <!-- Chart Section -->
    <div class="mt-8 p-6 bg-gray-800 rounded-lg shadow flex justify-center">
        <div class="w-full max-w-[90vw] h-[300px]">
            <canvas id="visitorChart"></canvas>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const socket = io();

// Update Stats
socket.on("update_stats", (data) => {
    document.getElementById('total').innerText = data.total_visitors;
    document.getElementById('unique').innerText = data.total_unique_visitors;
    document.getElementById('daily').innerText = data.daily_visitors;
    document.getElementById('daily_unique').innerText = data.daily_unique_visitors;
    document.getElementById('active').innerText = data.current_active_visitors;

    updateChart(data);
});

// Create Chart
const ctx = document.getElementById('visitorChart').getContext('2d');
const visitorChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["Total", "Unique", "Today", "Today Unique", "Active"],
        datasets: [{
            label: 'Visitors',
            data: [0, 0, 0, 0, 0],  // Initial Data
            backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Function to Update Chart
function updateChart(data) {
    visitorChart.data.datasets[0].data = [
        data.total_visitors,
        data.total_unique_visitors,
        data.daily_visitors,
        data.daily_unique_visitors,
        data.current_active_visitors
    ];
    visitorChart.update();
}
</script>

{% endblock %}
